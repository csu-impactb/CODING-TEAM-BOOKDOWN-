<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Colony forming units to determine bacterial counts | ImpactTB/BAA: Standard Operating Procedures for Data Analysis</title>
<meta name="author" content="Colorado State University Coding Team">
<meta name="description" content="4.0.1 Downloads The downloads for this chapter are: Data collection template for recording colony forming units counted on each plate or section of plate in the laboratory [Report template] to...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 4 Colony forming units to determine bacterial counts | ImpactTB/BAA: Standard Operating Procedures for Data Analysis">
<meta property="og:type" content="book">
<meta property="og:description" content="4.0.1 Downloads The downloads for this chapter are: Data collection template for recording colony forming units counted on each plate or section of plate in the laboratory [Report template] to...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Colony forming units to determine bacterial counts | ImpactTB/BAA: Standard Operating Procedures for Data Analysis">
<meta name="twitter:description" content="4.0.1 Downloads The downloads for this chapter are: Data collection template for recording colony forming units counted on each plate or section of plate in the laboratory [Report template] to...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">ImpactTB/BAA: Standard Operating Procedures for Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Overview</a></li>
<li><a class="" href="experimental-metadata.html"><span class="header-section-number">2</span> Experimental metadata</a></li>
<li><a class="" href="animal-initial-conditions-and-weekly-weights.html"><span class="header-section-number">3</span> Animal initial conditions and weekly weights</a></li>
<li><a class="active" href="colony-forming-units-to-determine-bacterial-counts.html"><span class="header-section-number">4</span> Colony forming units to determine bacterial counts</a></li>
<li><a class="" href="enzyme-linked-immunosorbest-assay-elisa.html"><span class="header-section-number">5</span> Enzyme-linked immunosorbest assay (ELISA)</a></li>
<li><a class="" href="flow-cytometry.html"><span class="header-section-number">6</span> Flow cytometry</a></li>
<li><a class="" href="pathology.html"><span class="header-section-number">7</span> Pathology</a></li>
<li><a class="" href="proteomics.html"><span class="header-section-number">8</span> Proteomics</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="colony-forming-units-to-determine-bacterial-counts" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Colony forming units to determine bacterial counts<a class="anchor" aria-label="anchor" href="#colony-forming-units-to-determine-bacterial-counts"><i class="fas fa-link"></i></a>
</h1>
<div id="downloads-1" class="section level3" number="4.0.1">
<h3>
<span class="header-section-number">4.0.1</span> Downloads<a class="anchor" aria-label="anchor" href="#downloads-1"><i class="fas fa-link"></i></a>
</h3>
<p>The downloads for this chapter are:</p>
<ul>
<li>
<a href="https://github.com/csu-impactb/CODING-TEAM-BOOKDOWN-/raw/main/templates/data_collection_templates/cfu_collection_template.xlsx">Data collection template</a> for recording colony forming units counted on each
plate or section of plate in the laboratory</li>
<li>[Report template] to process data collected with the data template (when you go to this link, go to the “File” bar in your browser’s menu bar, chose “Save As,” then save the file as “animal_weights.Rmd”)</li>
<li>[Example output] from the report template</li>
</ul>
</div>
<div id="overview-2" class="section level3" number="4.0.2">
<h3>
<span class="header-section-number">4.0.2</span> Overview<a class="anchor" aria-label="anchor" href="#overview-2"><i class="fas fa-link"></i></a>
</h3>
<p>In the experiments, we will need to estimate the bacterial load of
<em>Mycobacterium tuberculosis</em> in organs—including lungs and spleens—of
animals from experiments. These measurements help us assess how well a vaccine
has worked in comparison to controls.</p>
<p>We will be estimating bacterial load in an animal organ using the plate count
method with serial dilutions. Serial dilutions allow you to create a
highly diluted sample without needing a massive amount of diluent: as you
increase the dilution one step at a time, you can steadily bring the samples
down to lower bacterial loads per volume. This method is common across
laboratories that study tuberculosis drug efficacy as a method for estimating
bacterial load in animal organs <span class="citation">(<a href="references.html#ref-franzblau2012comprehensive" role="doc-biblioref">Franzblau et al. 2012</a>)</span> and is a
well-established method across microbiology in general, dating back to Koch in
the late 1800s <span class="citation">(<a href="references.html#ref-wilson1922proportion" role="doc-biblioref">Wilson 1922</a>; <a href="references.html#ref-ben2014estimation" role="doc-biblioref">Ben-David and Davidson 2014</a>)</span>.</p>
<p>With this method, we homogenize part of the organ, and then create several
increasingly dilute samples. Each dilution is then spread on a plate with a
medium in which <em>Mycobacterium tuberculosis</em> can grow and left to grow for
several weeks at a temperature conducive to <em>Mycobacterium tuberculosis</em> growth.
The idea is that individual bacteria from the original sample end up randomly
spread across the surface of the plate, and any bacteria that are viable
(able to reproduce) will form a new colony that, after a while, you’ll be able
to see <span class="citation">(<a href="references.html#ref-wilson1922proportion" role="doc-biblioref">Wilson 1922</a>; <a href="references.html#ref-goldman2015practical" role="doc-biblioref">Goldman and Green 2015</a>)</span>. At the end of this
incubation period, you can count the number of these colony-forming units
(CFUs) on each plate.</p>
<p>To count the number of CFUs, you need a “just right” dilution (and
we often won’t know what this is until after plating) to have a countable
plate. If you have too high of a dilution (i.e., one with very few viable
bacteria), randomness will play a big role in the CFU count, and you’ll estimate
the original with more variability, which isn’t ideal. If you have too low
of a dilution (i.e., one with lots of viable bacteria), it will be difficult to
identify separate colonies, and they may compete for resources. (The pattern
you see when the dilution is too low (i.e., too concentrated with bacteria) is
called a lawn—colonies merge together).</p>
<p>Once you identify a good dilution for each sample, the CFU count from this
dilution can be used to estimate the bacterial load in the animal’s organ. To
translate from diluted concentration to original concentration, you do a
back-calculation, incorporating both the number of colonies counted at that
dilution and how dilute the sample was <span class="citation">(<a href="references.html#ref-ben2014estimation" role="doc-biblioref">Ben-David and Davidson 2014</a>; <a href="references.html#ref-goldman2015practical" role="doc-biblioref">Goldman and Green 2015</a>)</span>.</p>
</div>
<div id="template-description-1" class="section level3" number="4.0.3">
<h3>
<span class="header-section-number">4.0.3</span> Template description<a class="anchor" aria-label="anchor" href="#template-description-1"><i class="fas fa-link"></i></a>
</h3>
<p>The data are collected in a spreadsheet with multiple sheets. The first sheet
(named “metadata”) is used to record some metadata for the experiment, while the
following sheets are used to record CFUs counts from the plates used for samples
from each organ, with one sheet per organ. For example, if you plated data
from both the lung and spleen, there would be three sheets in the file: one
with the metadata, one with the plate counts for the lung, and one with the
plate counts for the spleen.</p>
<p>The first sheet, which is the metadata sheet, is shown below:</p>
<div class="inline-figure"><img src="figures/cfu_template_metadata.png" width="100%"></div>
<p>This metadata sheet is used to record information about the overall process of
plating the data. Values from this sheet will be used in calculating the bacterial
load in the original sample based on the CFU counts. This spreadsheet includes
the following columns:</p>
<ul>
<li>
<code>organ</code>: Include one row for each organ that was plated in the experiment.
You should name the organ all in lowercase (e.g., “lung,” “spleen”). You
should use the same name to also name the sheet that records data for that organ
for example, if you have rows in the metadata sheet for “lung” and “spleen,”
then you should have two other sheets in the file, one sheet named “lung” and
one named “spleen,” which you’ll use to store the plate counts for each of those
organs.</li>
<li>
<code>percentage_of_organ</code>: In this column, give the proportion of that organ that
was plated. For example, if you plated half the lung, then in the “lung” row
of this spread sheet, you should put 0.5 in the <code>prop_resuspended</code> column.</li>
<li>
<code>aliquot_ul</code>: 100 uL of the total_resuspended slurry would be considered an original aliquot and is used to peform serial dilutions.</li>
<li>
<code>dilution_factor</code>: Amount of the original stock solution that is present in the
total solution, after dilution(s)</li>
<li>
<code>total_resuspended_mL</code>: This column contains an original volume of tissue homogenate. For example, raw lung tissue is homogenized in 0.5 mL of PBS in a tube containing metal beads.</li>
<li>
<code>volume_plated_ul</code>: Amount of suspension + diluent plated on section of solid agar</li>
</ul>
<p>Following this first sheet in the file, you should have one sheet for each
organ. The organs that you record in these sheets should match up with the rows
on the first, metadata sheet of the template.</p>
<p>Each of these organ-specific sheets should look like this:</p>
<div class="inline-figure"><img src="figures/cfu_organ_sheet_example.png" width="100%"></div>
<p>Each of these organ-specific sheets of the template include the following columns:</p>
<ul>
<li>
<code>count_date</code>: The date that the CFUs were counted. In some cases, the same plates
may be counted at multiple dates.</li>
<li>
<code>who_plated</code>: An identifier for the researcher who plated the sample</li>
<li>
<code>who_counted</code>: An identifier for the researcher who counted the plate on this
specific date</li>
<li>
<code>groups</code>: The experimental group to which the mouse belonged to</li>
<li>
<code>mouse</code>: An identifier for the unique mouse within the group (<em>note: as we
collect data from the new experiment, this can be a unique ID by mouse, based on
notch ID and cage number</em>)</li>
<li>
<code>dil_0</code>, <code>dil_1</code>, <code>dil_2</code>, …: The count at each dilution. You can add additional
columns if there were more dilutions that are in the template or take away
dilution columns if there were fewer. However, all dilution columns should be
named consistently, with “dil_” followed by the dilution number (e.g., “0,” “1,”
“2”). If the CFUs were too numerous to count for a sample at a particular
dilution, put “TNTC” in that cell of the spreadsheet.</li>
</ul>
<p>You can download the template <a href="https://github.com/csu-impactb/CODING-TEAM-BOOKDOWN-/raw/main/templates/data_collection_templates/cfu_collection_template.xlsx">here</a>.
When you download the template, it will have example values filled out in blue.
Use these to get an idea for how to record your own data. When you are ready
to record your own data, delete these example values and replace them with
data collected from your own experiment.</p>
</div>
<div id="processing-collected-data-1" class="section level3" number="4.0.4">
<h3>
<span class="header-section-number">4.0.4</span> Processing collected data<a class="anchor" aria-label="anchor" href="#processing-collected-data-1"><i class="fas fa-link"></i></a>
</h3>
<p>Once data are collected, the file can be run through an R workflow. This workflow
will convert the data into a format that is easier to work with for data analysis
and visualization. It will also produce a report on the data in the spreadsheet, and
ultimately it will also write relevant results in a format that can be used
to populate a global database for all experiments in the project.</p>
<p>The next section provides the details of the pipeline. It aims to explain the
code that processes the data and generates visualizations. You do not need to
run this code step-by-step, but instead can access a script with the full
code [here].</p>
<p>To use this reporting template, you need to download it to your computer and
save it in the file directory where you saved the data you collected with the
data collection template. You can then open RStudio and navigate so that you are
working within this directory. You should also make sure that you have installed
a few required packages on R on the computer you are using to run the report.
These packages are: … .</p>
<p>Within RStudio, open the report template file. There is one spot where you will
need to change the code in the template file, so it will read in the data from
the version of the template that you saved, which you may have renamed.
In the YAML of the report template file, change the file path beside “data:”
so that it is the file name of your data file.</p>
<p>Once you’ve made this change, you can use the “Knit” button in RStudio to
create a report from the data file and the report template file.</p>
<p>The report includes the following elements:</p>
<ul>
<li>
</ul>
<p>You can download an example of a report created using this template by
clicking [here].</p>
<p>When you knit to create the report, it will create a Word file in the
same file directory where you put your data file and report template.
It will also create and output a version of the data that has been
processed (in the case of the weights data, this mainly involves
tracking mice as they change cages, to link all weights that are from
a single animal). This output fill will be named “cfu_output.csv” and, like
the report file, will be saved in the same file directory as the
data file and the report template.</p>
</div>
<div id="details-of-processing-script-1" class="section level3" number="4.0.5">
<h3>
<span class="header-section-number">4.0.5</span> Details of processing script<a class="anchor" aria-label="anchor" href="#details-of-processing-script-1"><i class="fas fa-link"></i></a>
</h3>
<p>This section goes through the code within the report template. It
explains each part of the code in detail. You do not need to understand
these details to use the report template. However, if you have questions
about how the data are being processed, or how the outputs are created,
all those details are available in this section.</p>
<p>As a note, there are two places in the following code where there’s a small
change compared to the report template. In the report, you incorporate the path
to the data file using the <code>data:</code> section in the YAML at the top of the
document. In the following code, we’ve instead used the path of some example
data within this book’s file directory, so the code will run for this chapter as
well.</p>
<p>First, the workflow loads some additional R libraries. You may need to install
these on your local R session if you do not already have them installed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></code></pre></div>
<p>Next, the pipeline reads in the organ-specific data. To do this, it creates a
list of all of the sheets that are in the spreadsheet other than the metadata
sheet. It then loops through each of these organ-specific sheets. It uses
pivoting to convert all the dilution levels and values into two columns
(a longer rather than wider format), so that the data from all the organs can
be joined into a single large dataframe, even if a different number of dilutions
were used for the different organs.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a list of all the sheets in the file. Exclude the metadata sheet </span>
<span class="co"># to get a list of the organ-specific sheets</span>
<span class="va">sheet_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="st">"DATA/baa_cfu_sheet.xlsx"</span><span class="op">)</span>
<span class="va">organ_sheets</span> <span class="op">&lt;-</span> <span class="va">sheet_names</span><span class="op">[</span><span class="va">sheet_names</span> <span class="op">!=</span> <span class="st">"metadata"</span><span class="op">]</span>

<span class="co"># Loop through all the organ-specific sheets and read them in as an </span>
<span class="co"># element in a list. Use pivoting to collect all the dilutions in a </span>
<span class="co"># way that will let you bind across all organs, even if a different</span>
<span class="co"># set of dilutions were used for the different organs.</span>
<span class="va">merged_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">organ_sheets</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"DATA/baa_cfu_sheet.xlsx"</span>, 
                     sheet <span class="op">=</span> <span class="va">organ_sheets</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>organ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">organ_sheets</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="co">#mutate(missing_col = NA) %&gt;% </span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if</a></span><span class="op">(</span><span class="va">is.double</span>, <span class="va">as.numeric</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if</a></span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">as.character</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"dil_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"dilution"</span>,
                 values_to <span class="op">=</span> <span class="st">"CFUs"</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dilution <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">dilution</span>, <span class="st">"[0-9]+"</span><span class="op">)</span>,
           dilution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dilution</span><span class="op">)</span><span class="op">)</span>
    
  <span class="va">merged_data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data</span>
<span class="op">}</span>

<span class="co"># Bind all the organ-specific datasets into a single large dataset</span>
<span class="va">all_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">merged_data</span>, .id <span class="op">=</span> <span class="st">"column_label"</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">column_label</span><span class="op">)</span></code></pre></div>
<p>At this stage, here is how the beginning of this dataset looks:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_data</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 8
##   count_date            who_plated who_counted groups mouse organ dilution CFUs 
##   &lt;chr&gt;                 &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;
## 1 "\"February 21 2022\… BK         BK          group… A     lung         0 TNTC 
## 2 "\"February 21 2022\… BK         BK          group… A     lung         1 TNTC 
## 3 "\"February 21 2022\… BK         BK          group… A     lung         2 TNTC 
## 4 "\"February 21 2022\… BK         BK          group… A     lung         3 53   
## 5 "\"February 21 2022\… BK         BK          group… A     lung         4 9</code></pre>
<p>You can see that, rather than having separate columns for each dilution level
on a single row for a sample, there are now multiple rows per sample, with the
CFUs at different dilutions given in a <code>CFUs</code> column, with the <code>dilution</code> column
identifying which dilution level for each.</p>
<p>The next steps work through the data, identifying which dilution is an
appropriate one to use to count CFUs for each sample.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Pull out numeric dilution value and filter for dilutions with CFUs between 10-75</span>
<span class="va">tidy_cfu_data</span> <span class="op">&lt;-</span> <span class="va">all_data</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dilution <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">dilution</span>, <span class="st">"[0-9]+"</span><span class="op">)</span>,
         dilution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dilution</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">CFUs</span> <span class="op">&gt;=</span> <span class="fl">5</span> <span class="op">&amp;</span> <span class="va">CFUs</span> <span class="op">&lt;=</span> <span class="fl">95</span><span class="op">)</span> <span class="op">|</span> <span class="va">groups</span> <span class="op">==</span> <span class="st">"control"</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>CFUs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">CFUs</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p>In the example data, this step has reduced the number observations to consider
from over 450 to 60.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">all_data</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 454</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tidy_cfu_data</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 60</code></pre>
<p>If you look at the first few rows of the data before and after cleaning, you can
see that in particular it has removed a lot of “TNTC” values (as well as a lot
of 0 values, although that’s harder to see in this sample of the data):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_data</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 8
##   count_date            who_plated who_counted groups mouse organ dilution CFUs 
##   &lt;chr&gt;                 &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;
## 1 "\"February 21 2022\… BK         BK          group… A     lung         0 TNTC 
## 2 "\"February 21 2022\… BK         BK          group… A     lung         1 TNTC 
## 3 "\"February 21 2022\… BK         BK          group… A     lung         2 TNTC 
## 4 "\"February 21 2022\… BK         BK          group… A     lung         3 53   
## 5 "\"February 21 2022\… BK         BK          group… A     lung         4 9</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy_cfu_data</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 8
##   count_date            who_plated who_counted groups mouse organ dilution  CFUs
##   &lt;chr&gt;                 &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1 "\"February 21 2022\… BK         BK          group… A     lung         3    53
## 2 "\"February 21 2022\… BK         BK          group… A     lung         4     9
## 3 "\"February 21 2022\… BK         BK          group… C     lung         5     8
## 4 "\"February 21 2022\… BK         BK          group… D     lung         3    53
## 5 "\"February 21 2022\… BK         BK          group… A     lung         2    92</code></pre>
<p>Next, the code brings in the information from the metadata sheet, including data on
what percent of each organ was resuspended, the dilution factor, and so on.
It uses this information to take the CFU value at a given dilution and convert
it to an estimate of CFUs per mL.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate CFU/ml for every qualifying replicate between 10-75 CFUs. </span>
<span class="co"># Column binding by organ name to the metadata sheet via inner_join().</span>
<span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"DATA/baa_cfu_sheet.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"metadata"</span><span class="op">)</span>

<span class="va">tidy_cfu_meta_joined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">tidy_cfu_data</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>CFUs_per_ml <span class="op">=</span> <span class="op">(</span><span class="va">CFUs</span> <span class="op">*</span> <span class="op">(</span><span class="va">dilution_factor</span> <span class="op">^</span> <span class="va">dilution</span><span class="op">)</span> <span class="op">*</span> 
                          <span class="op">(</span><span class="va">total_resuspension_mL</span> <span class="op">/</span> <span class="va">volume_plated_ul</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">organ</span>, <span class="va">count_date</span>, <span class="va">who_plated</span>, <span class="va">who_counted</span>, <span class="va">groups</span>,  <span class="va">mouse</span>, <span class="va">dilution</span>,  
         <span class="va">CFUs</span>, <span class="va">CFUs_per_ml</span><span class="op">)</span> </code></pre></div>
<pre><code>## Joining, by = "organ"</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tidy_cfu_meta_joined</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 9
##   organ count_date            who_plated who_counted groups mouse dilution  CFUs
##   &lt;chr&gt; &lt;chr&gt;                 &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1 lung  "\"February 21 2022\… BK         BK          group… A            3    53
## 2 lung  "\"February 21 2022\… BK         BK          group… A            4     9
## 3 lung  "\"February 21 2022\… BK         BK          group… C            5     8
## 4 lung  "\"February 21 2022\… BK         BK          group… D            3    53
## 5 lung  "\"February 21 2022\… BK         BK          group… A            2    92
## 6 lung  "\"February 21 2022\… BK         BK          group… A            4     7
## # … with 1 more variable: CFUs_per_ml &lt;dbl&gt;</code></pre>
<p>The rest of the report code is used to provide summaries, visualizations, and
analysis of these data. First, there is code to provide a summary of the number
of mice, experimental groups, and some other details for each of the organs:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy_cfu_meta_joined</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">organ</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>`Experimental groups` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,
            `Dates counted` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">count_date</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, 
            `Total mice` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">groups</span>, <span class="va">mouse</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
            `Dilutions considered` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dilution</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                              collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="va">as.character</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">organ</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">":"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="st">"r"</span>, <span class="st">"l"</span><span class="op">)</span>, 
               caption <span class="op">=</span> <span class="st">"Organ-specific summary of the experiment"</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-30">Table 4.1: </span>Organ-specific summary of the experiment</caption>
<thead><tr class="header">
<th align="center">organ</th>
<th align="right">name</th>
<th align="left">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">lung</td>
<td align="right">Experimental groups:</td>
<td align="left">group_1, group_2, group_3, group_4</td>
</tr>
<tr class="even">
<td align="center">lung</td>
<td align="right">Dates counted:</td>
<td align="left">“February 21 2022,” “April 18 2022”</td>
</tr>
<tr class="odd">
<td align="center">lung</td>
<td align="right">Total mice:</td>
<td align="left">19</td>
</tr>
<tr class="even">
<td align="center">lung</td>
<td align="right">Dilutions considered:</td>
<td align="left">2, 3, 4, 5, 6</td>
</tr>
<tr class="odd">
<td align="center">spleen</td>
<td align="right">Experimental groups:</td>
<td align="left">group_1, group_2, group_3</td>
</tr>
<tr class="even">
<td align="center">spleen</td>
<td align="right">Dates counted:</td>
<td align="left">“April 25 2022”</td>
</tr>
<tr class="odd">
<td align="center">spleen</td>
<td align="right">Total mice:</td>
<td align="left">10</td>
</tr>
<tr class="even">
<td align="center">spleen</td>
<td align="right">Dilutions considered:</td>
<td align="left">1, 2, 3, 4</td>
</tr>
</tbody>
</table></div>
<p>Next, the pipeline provides a table with the conditions of the CFU collection,
based on the collected metadata from the template:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meta</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Organ"</span>, <span class="st">"Percent of organ plated"</span>, <span class="st">"Aliquot"</span>, 
                            <span class="st">"Dilution factor"</span>, <span class="st">"Total resuspension"</span>, 
                            <span class="st">"Volume plated"</span><span class="op">)</span>, 
               caption <span class="op">=</span> <span class="st">"Conditions of the CFU collection"</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-31">Table 4.2: </span>Conditions of the CFU collection</caption>
<colgroup>
<col width="7%">
<col width="27%">
<col width="9%">
<col width="18%">
<col width="21%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">Organ</th>
<th align="right">Percent of organ plated</th>
<th align="right">Aliquot</th>
<th align="right">Dilution factor</th>
<th align="right">Total resuspension</th>
<th align="right">Volume plated</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">lung</td>
<td align="right">33</td>
<td align="right">100</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">100</td>
</tr>
<tr class="even">
<td align="left">spleen</td>
<td align="right">50</td>
<td align="right">100</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">125</td>
</tr>
</tbody>
</table></div>
<p><strong>Distribution of CFUs at each dilution:</strong></p>
<p>Here’s a plot that shows how many plates were too numerous to count at each
dilution level:</p>
<p>Here is a plot that shows how the CFU counts were distributed by dilution
level in the data:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy_lung_cfu_plot</span> <span class="op">&lt;-</span> <span class="va">tidy_cfu_meta_joined</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">organ</span> <span class="op">==</span> <span class="st">"lung"</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">groups</span>, <span class="st">"group_1"</span>, <span class="st">"group_2"</span>, <span class="st">"group_3"</span>, <span class="st">"group_4"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">groups</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">CFUs_per_ml</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">groups</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">stat_boxplot</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">groups</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">CFUs_per_ml</span><span class="op">)</span><span class="op">)</span>, 
    geom<span class="op">=</span><span class="st">'errorbar'</span>, linetype<span class="op">=</span><span class="fl">1</span>, width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">groups</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"CFUs in early infected mouse lung"</span><span class="op">)</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"log10(CFU/mL)"</span>,
       color <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/stat_compare_means.html">stat_compare_means</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"p.signif"</span>, method <span class="op">=</span> <span class="st">"t.test"</span>, ref.group <span class="op">=</span> <span class="st">"group_1"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>

<span class="va">tidy_lung_cfu_plot</span></code></pre></div>
<div class="inline-figure"><img src="csu-impactb_files/figure-html/unnamed-chunk-32-1.png" width="672"></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfu_stats</span> <span class="op">&lt;-</span> <span class="va">tidy_cfu_meta_joined</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">organ</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>aov_result <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">CFUs_per_ml</span> <span class="op">~</span> <span class="va">groups</span>, data <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span>,
         tukey_result <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">aov_result</span>, <span class="va">TukeyHSD</span><span class="op">)</span>,
         tidy_tukey <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">tukey_result</span>, <span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">tidy_tukey</span>, .drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">contrast</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"contrast1"</span>, <span class="st">"contrast2"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span>, <span class="op">-</span><span class="va">aov_result</span>, <span class="op">-</span><span class="va">tukey_result</span>, <span class="op">-</span><span class="va">term</span>, <span class="op">-</span><span class="va">null.value</span><span class="op">)</span><span class="co"># %&gt;%</span></code></pre></div>
<pre><code>## Warning: The `.drop` argument of `unnest()` is deprecated as of tidyr 1.0.0.
## All list-columns are now preserved.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># filter(adj.p.value &lt;= 0.05)</span>

<span class="va">cfu_stats</span></code></pre></div>
<pre><code>## # A tibble: 9 × 7
## # Groups:   organ [2]
##   organ  contrast1 contrast2 estimate conf.low conf.high adj.p.value
##   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 lung   group_2   group_1    -60953. -138742.    16836.      0.171 
## 2 lung   group_3   group_1    -63903. -135699.     7893.      0.0963
## 3 lung   group_4   group_1    -26214. -102416.    49987.      0.793 
## 4 lung   group_3   group_2     -2950.  -69900.    64000.      0.999 
## 5 lung   group_4   group_2     34739.  -36915.   106393.      0.569 
## 6 lung   group_4   group_3     37689.  -27410.   102787.      0.417 
## 7 spleen group_2   group_1     -6565   -13529.      399.      0.0656
## 8 spleen group_3   group_1     -7310   -13341.    -1279.      0.0178
## 9 spleen group_3   group_2      -745.   -6776.     5286.      0.943</code></pre>
<p>As a last step, the code in the template writes a CSV file with the processed
data. This file will be an input into a script that will format the data to
add to a database where we are collecting and integrating data from all the CSU
experiments, and ultimately from there into project-wide storage.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Write out processed data into a CSV file</span>
<span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">tidy_cfu_meta_joined</span>, <span class="st">"cfu_output.csv"</span><span class="op">)</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="animal-initial-conditions-and-weekly-weights.html"><span class="header-section-number">3</span> Animal initial conditions and weekly weights</a></div>
<div class="next"><a href="enzyme-linked-immunosorbest-assay-elisa.html"><span class="header-section-number">5</span> Enzyme-linked immunosorbest assay (ELISA)</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav"><li>
<a class="nav-link" href="#colony-forming-units-to-determine-bacterial-counts"><span class="header-section-number">4</span> Colony forming units to determine bacterial counts</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#downloads-1"><span class="header-section-number">4.0.1</span> Downloads</a></li>
<li><a class="nav-link" href="#overview-2"><span class="header-section-number">4.0.2</span> Overview</a></li>
<li><a class="nav-link" href="#template-description-1"><span class="header-section-number">4.0.3</span> Template description</a></li>
<li><a class="nav-link" href="#processing-collected-data-1"><span class="header-section-number">4.0.4</span> Processing collected data</a></li>
<li><a class="nav-link" href="#details-of-processing-script-1"><span class="header-section-number">4.0.5</span> Details of processing script</a></li>
</ul>
</li></ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>ImpactTB/BAA: Standard Operating Procedures for Data Analysis</strong>" was written by Colorado State University Coding Team. It was last built on 2022-12-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
